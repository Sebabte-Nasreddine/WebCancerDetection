# Configuration Apache VirtualHost pour SkinCheck
# Fichier: /etc/apache2/sites-available/skincheck.conf

<VirtualHost *:80>
    ServerName votre-domaine.com
    ServerAlias www.votre-domaine.com
    
    # Redirection HTTP vers HTTPS
    RewriteEngine On
    RewriteCond %{HTTPS} off
    RewriteRule ^(.*)$ https://%{HTTP_HOST}$1 [R=301,L]
</VirtualHost>

<VirtualHost *:443>
    ServerName votre-domaine.com
    ServerAlias www.votre-domaine.com
    
    # Logs
    ErrorLog ${APACHE_LOG_DIR}/skincheck-error.log
    CustomLog ${APACHE_LOG_DIR}/skincheck-access.log combined
    
    # SSL Configuration (Let's Encrypt)
    SSLEngine on
    SSLCertificateFile /etc/letsencrypt/live/votre-domaine.com/fullchain.pem
    SSLCertificateKeyFile /etc/letsencrypt/live/votre-domaine.com/privkey.pem
    Include /etc/letsencrypt/options-ssl-apache.conf
    
    # Reverse Proxy vers Docker
    ProxyPreserveHost On
    ProxyPass / http://127.0.0.1:5000/
    ProxyPassReverse / http://127.0.0.1:5000/
    
    # Headers de sécurité
    Header always set X-Frame-Options "SAMEORIGIN"
    Header always set X-Content-Type-Options "nosniff"
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    
    # Limite de taille pour les uploads
    LimitRequestBody 10485760
    
    # Timeout pour les requêtes longues (analyse ML)
    ProxyTimeout 300
    TimeOut 300
</VirtualHost>
